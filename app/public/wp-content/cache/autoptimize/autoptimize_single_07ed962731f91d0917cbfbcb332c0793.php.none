document.addEventListener('DOMContentLoaded',function(){let totalPhotos=0;let loadedPhotos=0;function loadPhotos(resetFilters=false){const category=resetFilters?'':document.getElementById('category-filter').value||'';const format=resetFilters?'':document.getElementById('format-filter').value||'';const order=resetFilters?'DESC':document.getElementById('order-filter').value||'DESC';const data=new URLSearchParams({action:'filter_photos',category:category,format:format,order:order,});console.log('Data sent for filtering:',data.toString());fetch(nathalie_mota_ajax.url,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:data.toString(),}).then(response=>response.json()).then(responseData=>{document.getElementById('photo-list').innerHTML=responseData.html;totalPhotos=responseData.total;loadedPhotos=document.querySelectorAll('#photo-list .photo-item').length;addLightboxEvents();if(resetFilters){resetFilterSelectors();}}).catch(error=>{console.error('Error loading photos:',error);});}
function resetFilterSelectors(){document.getElementById('category-filter').value='';document.getElementById('format-filter').value='';document.getElementById('order-filter').value='DESC';document.querySelectorAll('.select-selected').forEach((element)=>{const defaultText=element.nextElementSibling.querySelector('option:selected').textContent;element.textContent=defaultText;});document.querySelectorAll('.select-items .same-as-selected').forEach((element)=>{element.classList.remove('same-as-selected');});}
document.getElementById('category-filter').addEventListener('change',function(){loadPhotos();});document.getElementById('format-filter').addEventListener('change',function(){loadPhotos();});document.getElementById('order-filter').addEventListener('change',function(){loadPhotos();});document.getElementById('load-more').addEventListener('click',function(){const offset=document.querySelectorAll('#photo-list .photo-item').length;if(loadedPhotos>=totalPhotos){if(!document.getElementById('category-filter').value&&!document.getElementById('format-filter').value&&document.getElementById('order-filter').value==='DESC'){alert("Toutes les photos sont déjà chargées.");return;}else{loadPhotos(true);alert("Il n'y a plus de photos à afficher correspondant à votre sélection. Réinitialisation des filtres.");return;}}
const category=document.getElementById('category-filter').value||'';const format=document.getElementById('format-filter').value||'';const order=document.getElementById('order-filter').value||'DESC';const data=new URLSearchParams({action:'load_more_photos',offset:offset,category:category,format:format,order:order,});console.log('Data sent for loading more:',data.toString());fetch(nathalie_mota_ajax.url,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded',},body:data.toString(),}).then(response=>response.json()).then(responseData=>{const photoList=document.getElementById('photo-list');const tempDiv=document.createElement('div');tempDiv.innerHTML=responseData.html;tempDiv.querySelectorAll('.photo-item').forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');if(!existingReferences.has(photoReference)){photoList.appendChild(photoItem);existingReferences.add(photoReference);}});loadedPhotos+=responseData.loaded;addLightboxEvents();}).catch(error=>{console.error('Error loading more photos:',error);});});loadPhotos();const customSelects=document.getElementsByClassName("custom-select");for(let i=0;i<customSelects.length;i++){const selElmnt=customSelects[i].getElementsByTagName("select")[0];const a=document.createElement("DIV");a.setAttribute("class","select-selected");a.innerHTML=selElmnt.options[selElmnt.selectedIndex].innerHTML;customSelects[i].appendChild(a);const b=document.createElement("DIV");b.setAttribute("class","select-items select-hide");for(let j=1;j<selElmnt.length;j++){const c=document.createElement("DIV");c.innerHTML=selElmnt.options[j].innerHTML;c.addEventListener("click",function(e){const s=this.parentNode.parentNode.getElementsByTagName("select")[0];const h=this.parentNode.previousSibling;for(let i=0;i<s.length;i++){if(s.options[i].innerHTML==this.innerHTML){s.selectedIndex=i;h.innerHTML=this.innerHTML;const y=this.parentNode.getElementsByClassName("same-as-selected");for(let k=0;k<y.length;k++){y[k].removeAttribute("class");}
this.setAttribute("class","same-as-selected");break;}}
h.click();loadPhotos();});b.appendChild(c);}
customSelects[i].appendChild(b);a.addEventListener("click",function(e){e.stopPropagation();closeAllSelect(this);this.nextSibling.classList.toggle("select-hide");this.classList.toggle("select-arrow-active");});}
function closeAllSelect(elmnt){const x=document.getElementsByClassName("select-items");const y=document.getElementsByClassName("select-selected");const arrNo=[];for(let i=0;i<y.length;i++){if(elmnt==y[i]){arrNo.push(i);}else{y[i].classList.remove("select-arrow-active");}}
for(let i=0;i<x.length;i++){if(arrNo.indexOf(i)===-1){x[i].classList.add("select-hide");}}}
document.addEventListener("click",closeAllSelect);});
document.addEventListener('DOMContentLoaded',function(){const loadMoreButton=document.getElementById('load-more');const photoList=document.getElementById('photo-list');let paged=1;let totalPhotos=0;let loadedPhotos=0;const existingReferences=new Set();function loadPhotos(reset=false){const category=document.getElementById('category-filter').value||'';const format=document.getElementById('format-filter').value||'';const order=document.getElementById('order-filter').value||'DESC';if(reset){paged=1;photoList.innerHTML='';loadedPhotos=0;existingReferences.clear();}
const offset=loadedPhotos;const data=new FormData();data.append('action','load_more_photos');data.append('paged',paged);data.append('offset',offset);data.append('category',category);data.append('format',format);data.append('order',order);data.append('nonce',nathalie_mota_ajax.nonce);console.log('Données envoyées pour charger plus:',{action:'load_more_photos',paged:paged,offset:offset,category:category,format:format,order:order,nonce:nathalie_mota_ajax.nonce});fetch(nathalie_mota_ajax.url,{method:'POST',body:data}).then(response=>{console.log('HTTP Response Status:',response.status);return response.json();}).then(responseData=>{console.log('Réponse complète:',responseData);if(!responseData.success){const errorMessage=responseData.data&&responseData.data.message?responseData.data.message:'Erreur inconnue';console.error('Erreur:',errorMessage);return;}
const tempDiv=document.createElement('div');tempDiv.innerHTML=responseData.data.html;tempDiv.querySelectorAll('.photo-item').forEach(photoItem=>{const photoReference=photoItem.getAttribute('data-reference');if(!existingReferences.has(photoReference)){photoList.appendChild(photoItem);existingReferences.add(photoReference);}});paged++;loadedPhotos=document.querySelectorAll('.photo-item').length;totalPhotos=responseData.data.total;console.log('Loaded Photos:',loadedPhotos,'Total Photos:',totalPhotos);if(loadedPhotos>=totalPhotos){loadMoreButton.style.display='none';}else{loadMoreButton.style.display='block';}
addLightboxEvents();}).catch(error=>{console.error('Erreur lors du chargement des photos:',error);});}
loadMoreButton.addEventListener('click',function(){loadPhotos();});document.getElementById('category-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('format-filter').addEventListener('change',()=>loadPhotos(true));document.getElementById('order-filter').addEventListener('change',()=>loadPhotos(true));});